

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Section 3.1 - Creating the Application Environments &mdash; Solutions Delivery Platform  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Section 3.2 - Setting up the Helm Chart Repository" href="3_2_Helm_Chart_Repo.html" />
    <link rel="prev" title="Section 3 - Setting up the Application Environments" href="3_0_Application_Environment_Overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Solutions Delivery Platform
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://jenkinsci.github.io/templating-engine-plugin">Jenkins Templating Engine</a></li>
<li class="toctree-l1"><a class="reference external" href="https://boozallen.github.io/sdp-libraries">Pipeline Libraries</a></li>
</ul>
<p class="caption"><span class="caption-text">Deployment Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">OpenShift</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_0_Deploy_Tools_Overview.html">Section 1 - Deploying the DevOps Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_1_Prepare_To_Install.html">Section 1.1 - Preparing to Run the Installer</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_2_Run_Installer.html">Section 1.2 - Running the Installer Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_0_Pipeline_Config_Overview.html">Section 2 - Setting Up a Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_1_Pipeline_Planning.html">Section 2.1 - Pipeline Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_2_Pipeline_Config.html">Section 2.2 - Creating the Pipeline Configuration Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_0_Application_Environment_Overview.html">Section 3 - Setting up the Application Environments</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Section 3.1 - Creating the Application Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_2_Helm_Chart_Repo.html">Section 3.2 - Setting up the Helm Chart Repository</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Learning Labs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../learning-labs/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning-labs/try-it-out/docs/index.html">Try It Out</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning-labs/local-development/index.html">Local Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning-labs/jte-the-basics/index.html">JTE: The Basics</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/helm-multitenancy.html">Helm Multitenancy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/add_jenkins_credentials.html">Add Credentials to Jenkins</a></li>
<li class="toctree-l1"><a class="reference external" href="https://help.github.com/articles/creating-a-new-organization-from-scratch/">Create a GitHub Organization</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.twistlock.com/2018/05/08/securing-containers-red-hat-openshift-twistlock-deployment-script/">Deploy Twistlock to OpenShift</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Solutions Delivery Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">OpenShift</a> &raquo;</li>
        
      <li>Section 3.1 - Creating the Application Environments</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/pages/deployment-guides/openshift/3_1_Application_Environments.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="section-3-1-creating-the-application-environments">
<h1>Section 3.1 - Creating the Application Environments<a class="headerlink" href="#section-3-1-creating-the-application-environments" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In order to use the <a href="/sdp-docs/pages/libraries/openshift/README.html" target="_blank">OpenShift library</a>’s <a href="https://github.com/boozallen/sdp-libraries/blob/master/openshift/deploy_to.groovy" target="_blank">deploy step</a>, there needs to be
set of pre-configured projects in OpenShift:</p>
<ul class="simple">
<li>The application environments, one or more Openshift projects that will host the application (e.g. “my-app-dev” &amp; “my-app-prod”)</li>
<li>A project to host container images that are shared between the application environments</li>
<li>A project to host the <a href="https://docs.helm.sh/glossary/#tiller" target="_blank">Tiller server</a> that manages the application environments.</li>
</ul>
<p>You can create all of these using the <a href="https://github.com/boozallen/sdp-helm-chart/blob/master/resources/helm/provision_app_envs.sh" target="_blank">provision_app_envs script</a>.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>In addition to the prerequisites covered in the <a href="/sdp-docs/pages/deployment-guides/openshift/3_0_Application_Environment_Overview.html" target="_blank">the section overview</a>, make sure</p>
<ol class="arabic simple">
<li>You are logged into the OpenShift cluster you’re deploying to as a user with the <a href="https://docs.openshift.com/container-platform/3.11/architecture/additional_concepts/authorization.html#roles" target="_blank">cluster-admin role</a></li>
<li>None of the projects that the provision app envs script will create already exist (not likely if this is your first run)</li>
</ol>
</div>
<div class="section" id="getting-provision-app-envs-sh">
<h2>Getting provision_app_envs.sh<a class="headerlink" href="#getting-provision-app-envs-sh" title="Permalink to this headline">¶</a></h2>
<p>Clone the <a href="https://github.com/boozallen/sdp-helm-chart" target="_blank">sdp-helm-chart repository</a> if you haven’t already, and use your
terminal to navigate to the <code class="docutils literal notranslate"><span class="pre">resources/helm</span></code> folder. You should see a file called
<code class="docutils literal notranslate"><span class="pre">provision_app_envs.sh</span></code>. You can execute it with the <code class="docutils literal notranslate"><span class="pre">-h</span></code> flag to view the
options for running it.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/boozallen/sdp-helm-chart.git
Cloning into &#39;sdp-helm-chart&#39;...
remote: Enumerating objects: 182, done.
remote: Counting objects: 100% (182/182), done.
remote: Compressing objects: 100% (135/135), done.
remote: Total 438 (delta 93), reused 108 (delta 45), pack-reused 256
Receiving objects: 100% (438/438), 2.26 MiB | 5.40 MiB/s, done.
Resolving deltas: 100% (211/211), done.
$ cd sdp-helm-chart/resources/helm
$ bash provision_app_envs.sh -h
script usage:
-p | set&#39;s the tenant prefix.
-e | define an app env. can be used multiple times.
-i | defines the project images will be pushed to.

example:
  ./provision_app_envs.sh -p rhs -e dev -e test -e staging -e prod -i red-hat-summit

this example would create the following projects:
 1) rhs-tiller     | tiller server for this tenant
 2) red-hat-summit | project for storing pushed images
 3) rhs-dev        | dev app environment
 4) rhs-test       | test app environment
 5) rhs-staging    | staging app environment
 6) rhs-prod       | prod app environment
where:
 1) rhs-{dev,test,staging} can pull images from red-hat-summit
 2) rhs-tiller can deploy resources to rhs-{dev,test,staging}
</pre></div>
</div>
</div>
<div class="section" id="the-options-you-need-to-decide-on">
<h2>The Options You Need to Decide On<a class="headerlink" href="#the-options-you-need-to-decide-on" title="Permalink to this headline">¶</a></h2>
<p>You need a prefix for the application environment names. It’s an arbitrary
name that makes it possible to distinguish your application from others that may
share the same cluster. This prefix is ideally an abbreviation of your project
name. In the example above, the prefix for the “RedHat Summit” project is “rhs.”</p>
<p>You need to know how many environments you want, as well as abbreviated names for
each. These abbreviated names are placed after <code class="docutils literal notranslate"><span class="pre">-e</span></code> in the script’s options.
In the example above, there are four environments being provisioned: dev, test,
staging, and prod. The script will create an OpenShift project for each one:
rhs-dev, rhs-test, rhs-staging, and rhs-prod.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These abbreviated names map to the “short names” of the <a href="http://localhost:8000/pages/jte/docs/pages/Templating/primitives/application_environments.html" target="_blank">application environments</a>
in your pipeline configuration file(s).</p>
</div>
<p>You also need a name for the project hosting the container images. This is the
<em>full name of the project</em> and will not necessarily include the prefix (unlike
the other projects being created). In the example above, that project is called
“red-hat-summit”.</p>
</div>
<div class="section" id="running-the-script">
<h2>Running The Script<a class="headerlink" href="#running-the-script" title="Permalink to this headline">¶</a></h2>
<p>Putting it all together, execute the provision_app_envs script, using the
appropriate flags to provide the three pieces of information covered above.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ bash provision_app_envs.sh -p <span class="nv">$PREFIX</span> -e <span class="nv">$ENV_1</span> -e <span class="nv">$ENV_2</span> ... -e <span class="nv">$ENV_N</span> -i <span class="nv">$IMAGE_PROJ</span>
</pre></div>
</div>
<p>The script should take care of the rest, creating and setting up projects for
the application environments, images, and tiller server. For example, if
you ran this command, with the prefix “demo”, a dev and prod environment, and
an image project called “demo”, you should see the projects below created:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ bash provision_app_envs.sh -p demo -e dev -e prod -i demo
</pre></div>
</div>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Provisioned OpenShift Infrastructure</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Project</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>demo-dev</td>
<td>The Development application environment</td>
</tr>
<tr class="row-odd"><td>demo-prod</td>
<td>The Production application environment</td>
</tr>
<tr class="row-even"><td>demo-tiller</td>
<td>The tiller project</td>
</tr>
<tr class="row-odd"><td>demo</td>
<td>The project where we will configure SDP to push container images</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adding-the-tiller-credential-to-jenkins">
<h2>Adding The Tiller Credential To Jenkins<a class="headerlink" href="#adding-the-tiller-credential-to-jenkins" title="Permalink to this headline">¶</a></h2>
<p>The tiller server just created cannot be used without credentials, so those
credentials need to be added to Jenkins. Assuming your tiller project is called “demo-tiller”, follow
<a class="reference internal" href="../../how-to/add_jenkins_credentials.html#add-credentials-to-jenkins"><span class="std std-ref">this guide</span></a> to create a username/password
credential in Jenkins with the username <code class="docutils literal notranslate"><span class="pre">system:serviceaccount:demo-tiller:tiller</span></code>
and use the command below to get the password, which will output a token you
need to copy-paste into Jenkins. For easy identification, make the credential’s
ID the same as the name of the tiller project (i.e. <em>demo-tiller</em>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ oc sa get-token tiller -n demo-tiller
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="3_2_Helm_Chart_Repo.html" class="btn btn-neutral float-right" title="Section 3.2 - Setting up the Helm Chart Repository" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="3_0_Application_Environment_Overview.html" class="btn btn-neutral float-left" title="Section 3 - Setting up the Application Environments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Booz Allen Hamilton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-144247959-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>